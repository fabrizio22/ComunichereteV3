<?Php/*Plugin Name: Widget ricerca utentePlugin Script: wp-wg-ricerca-utente.phpDescription: si potrà inserire una ricerca utente nella sezione della sidebar che ci interessaVersion: 1.0License: GPL 2.0Author: Fabrizio Fatelli*/class wg_ricerca_utente extends WP_Widget{    public function __construct()    {        parent::WP_Widget( 'ricerca-utente', 'RICERCA UTENTE', array('description' => 'Grazie a questo wg sarà possibile effettuare la ricerca utente'));    }    public function form( $instance ){?>    <?php    }    public function widget( $args, $instance )    {        global $wpdb;        extract( $args );        $bp_prefix = bp_core_get_table_prefix();        //$title = apply_filters('widget_title', 'Ricerca Profilo' );        $nomeUtente = $_POST['nomeUtente'];        $organoFiltro = $_POST['organoFiltro'];        $qualificaFiltro = $_POST['qualificaFiltro'];        $settoreAreaFiltro = $_POST['settoreAreaFiltro'];        $ufficioFiltro = $_POST['ufficioFiltro'];        $dipartimentoFiltro = $_POST['dipartimentoFiltro'];        $servizioFiltro = $_POST['servizioFiltro'];        $paeseFiltro = $_POST['paeseFiltro'];        $regioneFiltro = $_POST['regioneFiltro'];        $provinciaFiltro = $_POST['provinciaFiltro'];        $comuneFiltro = $_POST['comuneFiltro'];        $pubblicaAmministrazione = $_POST['pubblicaAmministrazione'];        $tipologiaEnte = $_POST['tipologiaEnte'];        $settoreprovincia = array("Affari Generali",            "Affari Istituzionali",            "Agricoltura, Agriturismo, Caccia, Funghi, Pesca",            "Ambiente, Energia",            "Archivio e protocollo generale",            "Attività produttive",            "Avvocatura",            "Bilancio",            "Controllo di Gestione",            "Cultura, sport e tempo libero",            "Difensore Civico",            "Difesa del Suolo",            "Direttore Generale - Segretario Generale",            "Economico Finanziario",            "Edilizia scolastica, patrimoniale e monumentale",            "Formazione Professionale",            "Informatica",            "Istruzione pubblica",            "Organizzazione Amministrativa - Attuazione del programma",            "Organizzazione e Sviluppo delle Risorse Umane",            "Pari opportunità",            "Patrimonio e Demanio",            "Politiche Ambientali",            "Politiche Comunitarie",            "Politiche del Lavoro e Servizi Impiego",            "Politiche del lavoro, Formazione professionale",            "Politiche della Scuola/Patrimonio/eGov",            "Politiche sociali, Pari opportunità",            "Polizia Provinciale",            "Procedure contrattuali",            "Protezione Civile",            "Risorse Umane",            "Segreteria particolare del Presidente",            "Servizi Sociali",            "Sicurezza stradale",            "Trasporti",            "Turismo e Cerimoniale",            "Ufficio Relazioni con il Pubblico",            "Ufficio Stampa",            "Urbanistica e Pianificazione territoriale",            "Viabilità");        $ufficio = array("S.U.A.P.",            "Ufficio Anagrafe",            "Ufficio Cultura, Sport e Turismo",            "Ufficio Economato",            "Ufficio Elettorale",            "Ufficio Giunta Comunale",            "Ufficio Lavori Pubblici",            "Ufficio Protocollo",            "Ufficio Relazioni con il pubblico",            "Ufficio Segreteria Generale",            "Ufficio Servizi Demografici",            "Ufficio Servizi Sociali");        $poliziaMunicipale = array("Polizia Giudiziaria",            "Contenzioso Permessi",            "Vigilanza Territoriale",            "Staff di Comando",            "Polizia Amministrativa",            "Polizia Ambientale",            "Nuclei Operativi Speciali");        $provincia = $wpdb->get_results(            $wpdb->prepare("select DISTINCT denominazione_provincia from  wp_elenco_comuni_istat", ARRAY_A)        );        $regioni = $wpdb->get_results(            $wpdb->prepare("select DISTINCT denominazione_regione from  wp_elenco_comuni_istat", ARRAY_A)        );        if(isset($nomeUtente)){            $query = $wpdb->get_row(                $wpdb->prepare("SELECT * FROM $wpdb->users WHERE user_login = %s", $nomeUtente, ARRAY_A)            );        }        if(isset($organoFiltro)){            $queryO = $wpdb->get_row(                $wpdb->prepare("SELECT * FROM wp_bp_xprofile_data WHERE value = %s", $organoFiltro, ARRAY_A)            );            //$organo = $wpdb->get_var( "SELECT * FROM {$bp_prefix}bp_xprofile_data where value = '". $organoFiltro."'");        }        $userId = $query->ID;        $display_name = $query->display_name;        $user_url = $query->user_url;        $user_email = $query->user_email;        $user_login = $query->user_login;        $id_organo = $queryO->user_id;        $value_organo = $queryO->value;        $querymeta = $wpdb->get_results(            $wpdb->prepare("SELECT * FROM $wpdb->usermeta WHERE user_id = %d", $userId, ARRAY_A)        );        $query = $wpdb->get_row(            $wpdb->prepare("SELECT * FROM $wpdb->users WHERE id = %s", $id_organo, ARRAY_A)        );        $userId = $query->ID;        $display_name = $query->display_name;        $user_url = $query->user_url;        $user_email = $query->user_email;        $user_login = $query->user_login;        echo $before_widget;        echo $before_title . $title . $after_title;        ?>        <form action="<?php echo home_url( 'ricerca-utente' ); ?>" method="post">            <div class="filtriRicercaUtente">                <table id="filtri">                    <tr><td>                            <input type="text" class="inputUtente" name="nomeUtente" id="nomeUtente" placeholder="Scrivi il Nome Utente"><br/>                        </td></tr>                    <tr><td>   </tr></td>                    <tr><td>                            <?php include('inc/pubblicaAmministrazione.php'); ?>                    </td></tr>                    <tr><td>                            <?php include('inc/ente.php'); ?>                        </td></tr>                    <tr><td><br/>                            <input type="text" class="inputEnte" name="nomeEnte" id="nomeEnte" placeholder="Scrivi il Nome Ente">                        </td></tr><br/>                    <tr><td><hr></td></tr>                    <tr><td><a href="#" class="apertureSelezioni" id="apriImg">Filtra per Area Geografica</a></td></tr>                    <tr><td>                            <div id="areaGeografica" class="areaGeografica">                                <?php include('inc/nazione.php'); ?>                                <?php include('inc/ripartizioneGeo.php'); ?>                                <?php include('inc/popolazione.php'); ?>                                <?php include('inc/comuneLitoraneo.php'); ?>                                <?php include('inc/zonaAltimetrica.php'); ?>                                <?php include('inc/comuneMontano.php'); ?>                                <?php include('inc/comuneCapProvincia.php'); ?>                                <a href="#" class="apertureSelezioni" id="apriregione">Regioni</a>                                <div id="regioni" class="regioniOpt">                                    <ol class="facet-values">                                        <?php foreach ( $regioni as $status ) : ?>                                            <li class="facet-value"><input type="checkbox" name="<?php echo esc_attr( $status->denominazione_regione ); ?>" value="<?php echo esc_attr( $status->denominazione_regione ); ?>" />                                                <div class="label-container">                                                    <label class="facet-label" title="<?php echo esc_attr( $status->denominazione_regione ); ?>" ><?php echo esc_attr( $status->denominazione_regione ); ?></label>                                                </div>                                            </li>                                        <?php endforeach; ?>                                    </ol>                                </div>                                <a href="#" class="apertureSelezioni" id="apriprovince">Provincia</a>                                <div id="provincia" class="regioniOpt">                                    <ol class="facet-values">                                        <?php foreach ( $provincia as $status ) : ?>                                            <li class="facet-value"><input type="checkbox" name="<?php echo esc_attr( $status->denominazione_provincia ); ?>" value="<?php echo esc_attr( $status->denominazione_provincia ); ?>" />                                                <div class="label-container">                                                    <label class="facet-label" title="<?php echo esc_attr( $status->denominazione_provincia ); ?>" ><?php echo esc_attr( $status->denominazione_provincia ); ?></label>                                                </div>                                            </li>                                        <?php endforeach; ?>                                    </ol>                                </div>                            </div>                        </td></tr>                    <tr><td><a href="#" class="apertureSelezioni" id="apriqualifica">Qualifica</a></td></tr>                    <tr><td>                    <div id="qualifiche" class="qualificheOpt">                            <!--                qualifiche per la selezione comuni-->                            <div id="qualificheComuni" class="qualificheOpt">                                <?php include('inc/comuni/contestoComune.php'); ?>                                <div id="qualificheComuni" class="qualificheOpt">                                    <?php include('inc/qualifiche/comuni/cm_qualificheOragnoGov.php'); ?>                                </div>                                <div id="qualificheProvincie" class="qualificheOpt">                                    <?php include('inc/qualifiche/comuni/cm_qualificheOragnoContr.php'); ?>                                </div>                                <div id="qualificheRegione" class="qualificheOpt">                                    <?php include('inc/qualifiche/comuni/cm_qualifichePersonaleAmm.php'); ?>                                </div>                            </div>                            <!--                qualifiche per la selezione provincie-->                            <div id="qualificheProvincia" class="qualificheOpt">                                <?php include('inc//qualifiche/provincia/contestoProvincia.php'); ?>                                <div id="qualificheComuni" class="qualificheOpt">                                    <?php include('inc/qualifiche/provincia/pr_qualificheOragnoGov.php'); ?>                                </div>                                <div id="qualificheProvincie" class="qualificheOpt">                                    <?php include('inc/qualifiche/provincia/pr_qualificheOragnoContr.php'); ?>                                </div>                                <div id="qualificheRegione" class="qualificheOpt">                                    <?php include('inc/qualifiche/provincia/pr_qualifichePersonaleAmm.php'); ?>                                </div>                            </div>                            <!--                qualifiche per la selezione regioni-->                            <div id="qualificheRegione" class="qualificheOpt">                                <?php include('inc/qualifiche/regioni/contestoRegione.php'); ?>                                <div id="qualificheComuni" class="qualificheOpt">                                    <?php include('inc/qualifiche/regioni/qualificheOragnoGov.php'); ?>                                </div>                                <div id="qualificheProvincie" class="qualificheOpt">                                    <?php include('inc/qualifiche/regioni/qualificheOragnoContr.php'); ?>                                </div>                                <div id="qualificheRegione" class="qualificheOpt">                                    <?php include('inc/qualifiche/regioni/qualifichePersonaleAmm.php'); ?>                                </div>                            </div>                    </div>                            <tr><td>                    <tr><td><a class="apertureSelezioni" href="#" id="apristruttura">Struttura</a></td></tr>                    <tr><td>                            <div id="struttura" class="strutturaOpt">                                <?php include('inc/struttura/struttura.php'); ?>                                <div id="strutturaComune" class="">                                    <?php include('inc/struttura/comuni/cm_settoreUfficio.php'); ?>                                </div>                                <a href="#" class="apertureSelezioni" id="aprisettore">Provincia</a>                                <div id="strutturaSettoreProvincia" class="strutturaOpt">                                    <ol class="facet-values">                                        <?php foreach ( $settoreprovincia as $status ) : ?>                                            <li class="facet-value"><input type="checkbox" name="<?php echo esc_attr( $status ); ?>" value="<?php echo esc_attr( $status ); ?>" />                                                <div class="label-container">                                                    <label class="facet-label" title="<?php echo esc_attr( $status ); ?>" ><?php echo esc_attr( $status ); ?></label>                                                </div>                                            </li>                                        <?php endforeach; ?>                                    </ol>                                    <?php include('inc/struttura/provincia/strutturaInpOpth.php'); ?>                                </div>                                <div id="strutturaRegione" class="strutturaOpt">                                    <?php include('inc/struttura/comuni/cm_settori.php'); ?>                                    <?php include('inc/struttura/comuni/cm_settoreUfficio.php'); ?>                                    <?php include('inc/struttura/comuni/cm_strutturaInpOpt.php'); ?>                                    <?php include('inc/struttura/comuni/cm_ufficio.php'); ?>                                </div>                            </div>                            <tr><td>                                    <br/>                    <tr><td><input class="cerca" type="submit" name="cerca" id="cerca" value="Inizia Ricerca" </td></tr>                </table>            </div>        </form>        <div id="risultatoRicercaUtente" class="risultatoRicercaUtente">            <?php            //            //            echo $userId;            //            echo $display_name;            //            echo $user_url;            //            echo $user_email;            //            echo $user_login;            //            foreach ($querymeta as $v1) {            //                foreach ($v1 as $v2) {            //                    echo "$v2\n";            //                }            //            }            ?>            <table>                <tr><td><?php echo $userId;?></td></tr>                <tr><td><?php echo $display_name;?></td></tr>                <tr><td><?php echo $user_url;?></td></tr>                <tr><td><?php echo $user_email;?></td></tr>                <tr><td><?php echo $user_login;?></td></tr>                <tr><td><?php echo $id_organo;?></td></tr>                <tr><td><?php echo $value_organo;?></td></tr>            </table>        </div>        <?php        echo $after_widget;    }}function wg_ricerca_utente(){    register_widget( 'wg_ricerca_utente' );}add_action( 'widgets_init', 'wg_ricerca_utente' );?>