<?Php/*Plugin Name: Widget ricerca utentePlugin Script: wp-wg-ricerca-utente.phpDescription: si potrà inserire una ricerca utente nella sezione della sidebar che ci interessaVersion: 1.0License: GPL 2.0Author: Fabrizio Fatelli*/// rimuove dalla <head> la info sulla versione di wordpress installata sul sitoremove_action('wp_head', 'wp_generator');// toglie suggerimenti nella pagine di login in caso di login erratoadd_filter('login_errors',create_function('$a', "return null;"));wp_enqueue_style('ricerca_utente_css', WP_PLUGIN_URL . '/wp-wg-ricerca-utente/css/ricerca_utente.css');wp_enqueue_script('ricerca_utente_js', WP_PLUGIN_URL . '/wp-wg-ricerca-utente/js/ricerca_utente.js', array('jquery'));class wg_ricerca_utente extends WP_Widget{    public function __construct()    {        parent::WP_Widget( 'ricerca-utente', 'RICERCA UTENTE', array('description' => 'Grazie a questo wg sarà possibile effettuare la ricerca utente'));    }    public function form( $instance ){?>    <?php    }    public function widget( $args, $instance )    {        global $wpdb;        extract( $args );        $bp_prefix = bp_core_get_table_prefix();        //$title = apply_filters('widget_title', 'Ricerca Profilo' );        $nomeUtente = $_POST['nomeUtente'];        $organoFiltro = $_POST['organoFiltro'];        $qualificaFiltro = $_POST['qualificaFiltro'];        $settoreAreaFiltro = $_POST['settoreAreaFiltro'];        $ufficioFiltro = $_POST['ufficioFiltro'];        $dipartimentoFiltro = $_POST['dipartimentoFiltro'];        $servizioFiltro = $_POST['servizioFiltro'];        $paeseFiltro = $_POST['paeseFiltro'];        $regioneFiltro = $_POST['regioneFiltro'];        $provinciaFiltro = $_POST['provinciaFiltro'];        $comuneFiltro = $_POST['comuneFiltro'];        $pubblicaAmministrazione = $_POST['pubblicaAmministrazione'];        $tipologiaEnte = $_POST['tipologiaEnte'];        $deleghe = array("Affari Generali",            "Ambiente",            "Amministrazione Digitale",            "Arredo Urbano",            "Artigianato",            "Asili Nido",            "Attività Produttive",            "Bilancio e Tributi",            "Commercio e Industria",            "Comunicazione",            "Diritto allo Studio",            "Economato",            "Edilizia Privata",            "Energia",            "Guardie Ecologiche",            "Infrastrutture",            "Innovazione",            "Istruzione",            "Lavori Pubblici",            "Legalità Antimafia",            "Manutenzione Gestione Impianti",            "Marketing Territoriale",            "Mobilità",            "Organizzazione e Formazione",            "Parcheggi",            "Pari Opportunità",            "Partecipazione e Consulte di Quartiere",            "Patrimonio",            "Personale",            "Piano Del Traffico e Rete Trasporti",            "Piano Energetico ed Energie Rinnovabili",            "Politiche Abitative",            "Politiche Comunitarie",            "Politiche Culturali",            "Politiche della Famiglia",            "Politiche Giovanili",            "Politiche Migratorie",            "Politiche per il Lavoro",            "Politiche Sociali",            "Polizia",            "Protezione Civile",            "Rapporti Istituzionali",            "Ricerca e Innovazione",            "Scuola, Università, Ricerca, Formazione",            "Semplificazione",            "Servizi al Cittadino",            "Servizi Ambientali",            "Servizi e Manutenzioni Cimiteriali",            "Servizi Sociali",            "Sicurezza",            "Sistema Bibliotecari",            "Sistemi Informativi",            "Smart City",            "Società Partecipate",            "Spending Review",            "Strade",            "Sviluppo Economico",            "Sviluppo Sostenibile",            "Traffico",            "Turismo ed Eventi",            "Urbanistica",            "Verde Pubblico",            "Volontariato",            "Wifi Pubblico");        $settoreprovincia = array("Affari Generali",            "Affari Istituzionali",            "Agricoltura, Agriturismo, Caccia, Funghi, Pesca",            "Ambiente, Energia",            "Archivio e protocollo generale",            "Attività produttive",            "Avvocatura",            "Bilancio",            "Controllo di Gestione",            "Cultura, sport e tempo libero",            "Difensore Civico",            "Difesa del Suolo",            "Direttore Generale - Segretario Generale",            "Economico Finanziario",            "Edilizia scolastica, patrimoniale e monumentale",            "Formazione Professionale",            "Informatica",            "Istruzione pubblica",            "Organizzazione Amministrativa - Attuazione del programma",            "Organizzazione e Sviluppo delle Risorse Umane",            "Pari opportunità",            "Patrimonio e Demanio",            "Politiche Ambientali",            "Politiche Comunitarie",            "Politiche del Lavoro e Servizi Impiego",            "Politiche del lavoro, Formazione professionale",            "Politiche della Scuola/Patrimonio/eGov",            "Politiche sociali, Pari opportunità",            "Polizia Provinciale",            "Procedure contrattuali",            "Protezione Civile",            "Risorse Umane",            "Segreteria particolare del Presidente",            "Servizi Sociali",            "Sicurezza stradale",            "Trasporti",            "Turismo e Cerimoniale",            "Ufficio Relazioni con il Pubblico",            "Ufficio Stampa",            "Urbanistica e Pianificazione territoriale",            "Viabilità");        $ufficio = array("S.U.A.P.",            "Ufficio Anagrafe",            "Ufficio Cultura, Sport e Turismo",            "Ufficio Economato",            "Ufficio Elettorale",            "Ufficio Giunta Comunale",            "Ufficio Lavori Pubblici",            "Ufficio Protocollo",            "Ufficio Relazioni con il pubblico",            "Ufficio Segreteria Generale",            "Ufficio Servizi Demografici",            "Ufficio Servizi Sociali");        $poliziaMunicipale = array("Polizia Giudiziaria",            "Contenzioso Permessi",            "Vigilanza Territoriale",            "Staff di Comando",            "Polizia Amministrativa",            "Polizia Ambientale",            "Nuclei Operativi Speciali");        if (isset($_POST['Submit'])){            $provincia = $wpdb->get_results(                $wpdb->prepare("select DISTINCT denominazione_provincia from  wp_elenco_comuni_istat", ARRAY_A)            );            $regioni = $wpdb->get_results(                $wpdb->prepare("select DISTINCT denominazione_regione from  wp_elenco_comuni_istat", ARRAY_A)            );            if(isset($nomeUtente)){                $query = $wpdb->get_row(                    $wpdb->prepare("SELECT * FROM $wpdb->users WHERE user_login = %s", $nomeUtente, ARRAY_A)                );            }//            if(isset($organoFiltro)){//                $queryO = $wpdb->get_row(//                    $wpdb->prepare("SELECT * FROM wp_bp_xprofile_data WHERE value = %s", $organoFiltro, ARRAY_A)//                );//                //$organo = $wpdb->get_var( "SELECT * FROM {$bp_prefix}bp_xprofile_data where value = '". $organoFiltro."'");//            }////            $userId = $query->ID;//            $display_name = $query->display_name;//            $user_url = $query->user_url;//            $user_email = $query->user_email;//            $user_login = $query->user_login;////            $id_organo = $queryO->user_id;//            $value_organo = $queryO->value;////            $querymeta = $wpdb->get_results(//                $wpdb->prepare("SELECT * FROM $wpdb->usermeta WHERE user_id = %d", $userId, ARRAY_A)//            );////            $query = $wpdb->get_row(//                $wpdb->prepare("SELECT * FROM $wpdb->users WHERE id = %s", $id_organo, ARRAY_A)//            );//        }            $userId = $query->ID;            $display_name = $query->display_name;            $user_url = $query->user_url;            $user_email = $query->user_email;            $user_login = $query->user_login;//            if(($userId =="") || ($userId ==null)){//                if(){//                    $queryqual = $wpdb->get_var( $wpdb->prepare("SELECT name FROM wp_bp_xprofile_data WHERE value = %s", $id_fileld ));//                }////            }        }        echo $before_widget;        echo $before_title . $title . $after_title;        ?>        <?php include_once('inc/filtri_ricerca.php'); ?>        <div id="risultatoRicercaUtente" class="risultatoRicercaUtente">            <?php            if(isset($userId)){                $queryProfile = $wpdb->get_results( $wpdb->prepare("SELECT field_id, value FROM wp_bp_xprofile_data WHERE user_id = %s", $userId));            }            ?>            <table>                <tr>                    <td>Nome</td>                    <td>Cognome</td>                    <td>Comune</td>                    <td>Mail Ente</td>                    <td>Organo di Appartenenza</td>                </tr>                <?php                for ($i = 0; $i <= count($queryProfile) ; ++$i) {                    $id_fileld = $queryProfile[$i] -> field_id;                    $valueFild = $queryProfile[$i] -> value;                    //$queryfild = $wpdb->prepare("SELECT name FROM wp_bp_xprofile_fields WHERE id = %s", $id_fileld);                    $queryfildTitolo = $wpdb->get_var( $wpdb->prepare("SELECT name FROM wp_bp_xprofile_fields WHERE id = %s", $id_fileld ));                    if(($queryfildTitolo == 'Nome') && ($valueFild != '')){                        $nome =$valueFild;                        $queryfildTitolo ="";                    } else if(($queryfildTitolo == 'Cognome') && ($valueFild != '')){                        $Cognome =$valueFild;                        $queryfildTitolo ="";                    } else if(($queryfildTitolo == 'Comune') && ($valueFild != '')){                        $Comune = $valueFild;                        $queryfildTitolo ="";                    }else if(($queryfildTitolo == 'Mail Ente') && ($valueFild != '')){                        $MailEnte = $valueFild;                        $queryfildTitolo ="";                    }else if(($queryfildTitolo == 'Organo di Appartenenza') && ($valueFild != '')){                        $OrganoApp = $valueFild;                        $queryfildTitolo ="";                    }                }                ?>                <tr>                    <td><?php echo $nome; ?></td>                    <td><?php echo  $Cognome; ?></td>                    <td><?php echo  $Comune; ?></td>                    <td><?php echo  $MailEnte; ?></td>                    <td><?php echo  $OrganoApp; ?></td>                </tr>            </table>            <!--            <table>-->            <!--                <tr><td>--><?php //echo $userId;?><!--</td></tr>-->            <!--                <tr><td>--><?php //echo $display_name;?><!--</td></tr>-->            <!--                <tr><td>--><?php //echo $user_url;?><!--</td></tr>-->            <!--                <tr><td>--><?php //echo $user_email;?><!--</td></tr>-->            <!--                <tr><td>--><?php //echo $user_login;?><!--</td></tr>-->            <!--            </table>-->        </div>        <?php        echo $after_widget;    }}function wg_ricerca_utente(){    register_widget( 'wg_ricerca_utente' );}add_action( 'widgets_init', 'wg_ricerca_utente' );?>